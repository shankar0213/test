import paramiko
import pandas as pd
from io import StringIO

# === Config ===
hostname = 'your.server.ip.address'     # IP or hostname of the Hive server
port = 22                               # default SSH port
username = 'your_ssh_username'
password = 'your_ssh_password'

# Hive query to run
hive_query = "SELECT * FROM your_database.your_table LIMIT 10;"

# === Connect via SSH and run Hive query ===
try:
    # Set up SSH client
    client = paramiko.SSHClient()
    client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
    client.connect(hostname, port=port, username=username, password=password)

    # Run Hive command
    hive_command = f"hive -e \"{hive_query}\""
    stdin, stdout, stderr = client.exec_command(hive_command)

    # Get output and error
    output = stdout.read().decode()
    error = stderr.read().decode()

    if error:
        print("Error running Hive query:", error)
    else:
        # Convert output to DataFrame
        lines = output.strip().split('\n')
        header = lines[0].split('\t')
        data = [line.split('\t') for line in lines[1:]]

        df = pd.DataFrame(data, columns=header)
        print(df)

except Exception as e:
    print("SSH or Hive execution failed:", str(e))
finally:
    client.close()
